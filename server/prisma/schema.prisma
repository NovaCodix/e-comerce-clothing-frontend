// 1. CONFIGURACIÓN
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --------------------------------------
// 2. EL CATÁLOGO (Ropa y Categorías)
// --------------------------------------

// Categorías: Mujer, Hombre, Niños, Accesorios...
model Category {
  id          String    @id @default(uuid())
  name        String    // Ej: "Mujer"
  slug        String    @unique // Ej: "mujer" (para la URL bonita)
  description String?
  products    Product[] // Relación: Una categoría tiene mucha ropa
  createdAt   DateTime  @default(now())
}

// El Producto "Padre" (La ficha técnica)
model Product {
  id            String   @id @default(uuid())
  name          String
  slug          String   @unique
  description   String
  basePrice     Decimal  @db.Decimal(10, 2)
  discountPrice Decimal? @db.Decimal(10, 2)
  
  // --- NUEVOS CAMPOS DE DETALLE ---
  materialInfo  String?  @db.Text // Para "Materiales y Cuidado"
  shippingInfo  String?  @db.Text // Para "Envío y Devoluciones" (Opcional)
  
  // ... resto de campos (isTrending, category, images, etc.)
  isTrending    Boolean  @default(false)
  isNewArrival  Boolean  @default(true)
  isFeatured    Boolean  @default(false)
  gender        String   @default("Unisex") // Hombre, Mujer, Niños, Accesorios, Unisex
  
  category      Category @relation(fields: [categoryId], references: [id])
  categoryId    String

  images        ProductImage[]
  variants      ProductVariant[]
  orderItems    OrderItem[]

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  isActive      Boolean  @default(true)
  
}

// --------------------------------------
// 3. EL INVENTARIO REAL (Variantes)
// --------------------------------------

// Aquí controlas el stock exacto por combinación
model ProductVariant {
  id        String  @id @default(uuid())
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId String

  size      String  // Ej: "XS", "M", "42"
  color     String  // Ej: "Lavanda", "#E6E6FA" (Nombre o Hex)
  stock     Int     // Ej: 5 (Solo quedan 5 de ESTA talla y color)
  sku       String? @unique // Código de almacén (opcional pero recomendado)
  
  orderItems OrderItem[] // Relación con items de órdenes
}

// --------------------------------------
// 4. LAS IMÁGENES
// --------------------------------------

model ProductImage {
  id        String  @id @default(uuid())
  url       String  // El LINK que te da Cloudinary o tu carpeta local
  altText   String? // Para accesibilidad (SEO)
  isMain    Boolean @default(false) // true = Foto de portada, false = Foto del carrusel
  color     String? // Color asociado a esta imagen (HEX o nombre)
  order     Int     @default(0) // Orden de visualización en la galería
  
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId String
}

// --------------------------------------
// 5. VENTAS (Pedidos)
// --------------------------------------

// La cabecera del pedido
model Order {
  id              String      @id @default(uuid())
  orderNumber     String      @unique @default(cuid()) // Número de orden legible
  total           Decimal     @db.Decimal(10, 2)      // Total final pagado (productos + envío)
  shippingCost    Decimal     @default(0.00) @db.Decimal(10, 2) // Costo de envío
  shippingType    String      @default("PICKUP") // "DELIVERY" o "PICKUP"
  status          OrderStatus @default(PENDING)
  
  // Método de pago
  paymentMethod   PaymentMethod @default(MANUAL)
  paymentProof    String?     // URL del comprobante subido
  
  // Datos del cliente (aunque no haya login, guardamos quién compró)
  customerName    String
  customerEmail   String?
  customerPhone   String
  shippingAddress String      // Puede ser un JSON stringificado o texto simple
  
  items           OrderItem[] 
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  @@index([status])
  @@index([createdAt])
}

// Estados de la orden
enum OrderStatus {
  PENDING       // Esperando pago
  PAID          // Pago confirmado
  PROCESSING    // En preparación
  SHIPPED       // Enviado
  DELIVERED     // Entregado
  CANCELLED     // Cancelado (devuelve stock)
}

// Métodos de pago
enum PaymentMethod {
  MANUAL        // Yape/Plin/Transferencia
  CARD          // Tarjeta (futuro)
}

// El detalle (Qué compró exactamente)
model OrderItem {
  id          String  @id @default(uuid())
  order       Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  orderId     String
  
  // Relación con el producto (para saber qué fue)
  product     Product @relation(fields: [productId], references: [id])
  productId   String
  
  // Referencia a la variante específica (talla/color)
  variant     ProductVariant? @relation(fields: [variantId], references: [id])
  variantId   String?

  // GUARDAMOS UNA COPIA DE LOS DATOS (Snapshot del momento de compra)
  productName String  // Nombre del producto al momento de compra
  quantity    Int
  size        String  // "M"
  color       String  // "Rojo"
  price       Decimal @db.Decimal(10, 2) // Precio unitario al que LO COMPRÓ
  
  @@index([orderId])
}
// Catálogo global de Tallas disponibles para selección
model Size {
  id    String @id @default(uuid())
  value String @unique // Ej: "S", "M", "42", "XXL"
}